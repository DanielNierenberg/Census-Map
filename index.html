<style>
    body { margin:0; padding:0; font-family: sans-serif; }
    #map { height: 100vh; }
    
    /* Container for all right-side controls to ensure they stack */
    .right-panel-stack {
        display: flex;
        flex-direction: column;
        gap: 10px;
        align-items: flex-end;
    }

    /* 1. STATUS PANEL */
    .status-panel-ui {
        background: white; padding: 12px; border-radius: 8px;
        box-shadow: 0 0 15px rgba(0,0,0,0.2); border: 2px solid #3388ff;
        width: 200px; text-align: center;
    }
    .count-num { font-size: 2em; color: #2d3436; font-weight: bold; display: block; }
    .label { font-size: 0.75em; color: #636e72; text-transform: uppercase; font-weight: bold; }

    /* 2. SEARCH BOX */
    .search-box-container {
        background: white; padding: 10px; border-radius: 8px;
        box-shadow: 0 1px 5px rgba(0,0,0,0.4);
        width: 200px;
    }
    #roadSearch { width: 100%; box-sizing: border-box; padding: 6px; margin-bottom: 8px; border: 1px solid #ccc; border-radius: 4px; }
    .btn-row { display: flex; gap: 5px; }
    .btn-row button { flex: 1; cursor: pointer; padding: 6px; background: #f8f9fa; border: 1px solid #ccc; border-radius: 4px; }

    /* 3. AUTOCOMPLETE */
    .suggestions {
        position: absolute; background: white; border: 1px solid #ccc;
        max-height: 180px; overflow-y: auto; z-index: 5000; /* High z-index */
        display: none; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    .suggestions div { padding: 8px; cursor: pointer; border-bottom: 1px solid #eee; font-size: 13px; }
    .suggestions div:hover { background-color: #f0f0f0; }
</style>

<body>
    <div id="map"></div>

    <script>
    (async function() {
        const map = L.map('map', { renderer: L.canvas(), preferCanvas: true }).setView([34.7304, -86.5861], 12);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        const buildingsLayer = L.layerGroup().addTo(map);
        const drawnItems = new L.FeatureGroup().addTo(map);
        let allBuildings = [];

        // --- RIGHT SIDE CONTROLS ---
        // We create one control for the Count and one for the Search to let Leaflet stack them
        
        // 1. Count Panel
        const countControl = L.control({ position: 'topright' });
        countControl.onAdd = function() {
            const div = L.DomUtil.create('div', 'status-panel-ui');
            div.innerHTML = `
                <div id="load-status">‚è≥ Loading...</div>
                <span class="label">Buildings Inside Shape</span>
                <span id="count-display" class="count-num">0</span>`;
            return div;
        };
        countControl.addTo(map);

        // 2. Search Panel
        const searchControl = L.control({ position: 'topright' });
        searchControl.onAdd = function() {
            const div = L.DomUtil.create('div', 'search-box-container');
            div.innerHTML = `<b>Locate Road</b><br>
                <input type="text" id="roadSearch" placeholder="Street name..." autocomplete="off"/>
                <div class="btn-row">
                    <button id="searchBtn">Go</button>
                    <button id="clearSearchBtn">Clear</button>
                </div>`;
            // Stop map clicks from firing when clicking inside the search box
            L.DomEvent.disableClickPropagation(div);
            return div;
        };
        searchControl.addTo(map);

        // 3. Broom (Cleaner) - Leaflet will put this below the Search automatically
        const cleaner = L.control({position: 'topright'});
        cleaner.onAdd = () => {
            const div = L.DomUtil.create('div', 'leaflet-bar leaflet-control');
            div.innerHTML = '<a href="#" title="Clear All" style="background:white;width:34px;height:34px;display:flex;align-items:center;justify-content:center;text-decoration:none;font-size:18px;">üßπ</a>';
            div.onclick = (e) => {
                e.preventDefault();
                buildingsLayer.clearLayers();
                drawnItems.clearLayers();
                document.getElementById('count-display').innerText = "0";
            };
            return div;
        };
        cleaner.addTo(map);

        // --- DRAWING TOOLS (LEFT SIDE) ---
        const drawControl = new L.Control.Draw({
            position: 'topleft',
            draw: { polyline: false, marker: false, circlemarker: false, polygon: true, rectangle: true, circle: true },
            edit: { featureGroup: drawnItems, remove: true }
        });
        map.addControl(drawControl);

        // (The rest of your Road Search logic and Building Search logic goes here...)
        // Ensure you use document.getElementById('roadSearch') AFTER searchControl.addTo(map)
    })();
    </script>
</body>
